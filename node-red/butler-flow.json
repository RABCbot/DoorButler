[{"id":"5120087.cf6a9f8","type":"mqtt in","z":"83b42288.2eb27","name":"say","topic":"hermes/tts/say","qos":"2","datatype":"json","broker":"7c4ce906.75ea08","x":230,"y":540,"wires":[["c2b86d70.bff77"]]},{"id":"86926281.34c41","type":"exec","z":"83b42288.2eb27","command":"aplay","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"play","x":590,"y":540,"wires":[["ddd83762.e6ea58"],[],[]]},{"id":"ae5e4270.505c4","type":"mqtt in","z":"83b42288.2eb27","name":"listen","topic":"hermes/asr/startListening","qos":"2","datatype":"json","broker":"7c4ce906.75ea08","x":230,"y":600,"wires":[["d17d428a.fb69a"]]},{"id":"a1df9e03.79547","type":"exec","z":"83b42288.2eb27","command":"arecord","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"record","x":590,"y":600,"wires":[[],[],[]]},{"id":"9b02a9a5.291f08","type":"function","z":"83b42288.2eb27","name":"assign","func":"var s = \"-q \"\ns += \"/home/pi/butler/say/\"\ns += msg.payload\ns += \".wav\"\n\nreturn {payload: s};","outputs":1,"noerr":0,"x":470,"y":540,"wires":[["86926281.34c41"]]},{"id":"9a9ca9fa.ec5e18","type":"function","z":"83b42288.2eb27","name":"assign","func":"var s = \"-q -d \"\ns += msg.payload.duration\ns += \" -t wav \"\ns += \"/home/pi/butler/listen/\"\ns += msg.payload\ns += \".wav\"\n\nreturn {payload: s};","outputs":1,"noerr":0,"x":470,"y":600,"wires":[["a1df9e03.79547"]]},{"id":"21e83437.4d3bcc","type":"mqtt in","z":"83b42288.2eb27","name":"recognize","topic":"hermes/nlu/recognize","qos":"2","datatype":"auto","broker":"7c4ce906.75ea08","x":220,"y":660,"wires":[["aa1f330.429dfd"]]},{"id":"bcef164b.31c748","type":"exec","z":"83b42288.2eb27","command":"nlu-wit","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"curl","x":590,"y":660,"wires":[[],[],[]]},{"id":"aa1f330.429dfd","type":"function","z":"83b42288.2eb27","name":"assign","func":"var s = \"-XPOST https://api.wit.ai/speech?v=20200525 \"\ns += \" -s\"\ns += \" -H 'Authorization: Bearer \"\ns += flow.get(\"token\")\ns += \"'\"\ns += \" -H 'Content-Type: audio/wav'\"\ns += \" --data-binary @/home/pi/butler/listen/response.wav\"\n\nreturn {payload: s};","outputs":1,"noerr":0,"x":470,"y":660,"wires":[["bcef164b.31c748"]]},{"id":"9a45335.49dd0d","type":"mqtt in","z":"83b42288.2eb27","name":"start","topic":"hermes/dialogueManager/startSession","qos":"2","datatype":"json","broker":"7c4ce906.75ea08","x":110,"y":140,"wires":[["cf5f4fab.23461"]]},{"id":"11c3a767.9eba09","type":"exec","z":"83b42288.2eb27","command":"aplay","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"play","x":530,"y":140,"wires":[["56e6439e.6551cc"],[],[]]},{"id":"86c2173d.241b08","type":"function","z":"83b42288.2eb27","name":"assign","func":"var s = \"-q \"\ns += \"/home/pi/butler/say/\"\ns += msg.payload\ns += \".wav\"\n\nreturn {payload: s};","outputs":1,"noerr":0,"x":410,"y":140,"wires":[["11c3a767.9eba09"]]},{"id":"cf0bc43e.25cd08","type":"exec","z":"83b42288.2eb27","command":"arecord","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"record","x":770,"y":140,"wires":[["a6426b45.415018"],[],[]]},{"id":"56e6439e.6551cc","type":"function","z":"83b42288.2eb27","name":"assign","func":"var s = \"-q -d 3\"\ns += \" -t wav \"\ns += \"/home/pi/butler/listen/response.wav\"\n\nreturn {payload: s};","outputs":1,"noerr":0,"x":650,"y":140,"wires":[["cf0bc43e.25cd08"]]},{"id":"52d7e397.2179bc","type":"exec","z":"83b42288.2eb27","command":"curl","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"nlu-wit","x":1010,"y":140,"wires":[["a550dbc1.96d108"],[],[]]},{"id":"a6426b45.415018","type":"function","z":"83b42288.2eb27","name":"assign","func":"var s = \"-XPOST https://api.wit.ai/speech?v=20200525 \"\ns += \" -s\"\ns += \" -H 'Authorization: Bearer \"\ns += flow.get(\"token\")\ns += \"'\"\ns += \" -H 'Content-Type: audio/wav'\"\ns += \" --data-binary @/home/pi/butler/listen/response.wav\"\n\nreturn {payload: s};","outputs":1,"noerr":0,"x":890,"y":140,"wires":[["52d7e397.2179bc"]]},{"id":"97938285.a463d","type":"change","z":"83b42288.2eb27","name":"ask-reason","rules":[{"t":"set","p":"payload","pt":"msg","to":"ask-reason","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":240,"wires":[["86c2173d.241b08"]]},{"id":"fea9ac5c.448fc","type":"switch","z":"83b42288.2eb27","name":"intent","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"VolumeIntent","vt":"str"},{"t":"eq","v":"DeliveryIntent","vt":"str"},{"t":"eq","v":"OtherIntent","vt":"str"},{"t":"eq","v":"YesIntent","vt":"str"},{"t":"eq","v":"NoIntent","vt":"str"},{"t":"eq","v":"SolicitingIntent","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":7,"x":110,"y":240,"wires":[["55b683a7.d0365c"],["e045772e.502778"],["9a3c4159.d2aba"],["20815855.34b168"],["96a2a4ff.817188"],["96a2a4ff.817188"],["68e1d9da.6bdf78"]]},{"id":"e045772e.502778","type":"change","z":"83b42288.2eb27","name":"ask-signature","rules":[{"t":"set","p":"payload","pt":"msg","to":"ask-signature","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":320,"wires":[["86c2173d.241b08"]]},{"id":"a550dbc1.96d108","type":"json","z":"83b42288.2eb27","name":"","property":"payload","action":"","pretty":false,"x":1130,"y":140,"wires":[["72540216.d5f0ec","3f1343e.d90b9bc"]]},{"id":"96a2a4ff.817188","type":"change","z":"83b42288.2eb27","name":"say-goodbye","rules":[{"t":"set","p":"payload","pt":"msg","to":"say-goodbye","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":440,"wires":[["9b02a9a5.291f08"]]},{"id":"9a3c4159.d2aba","type":"change","z":"83b42288.2eb27","name":"ask-presence","rules":[{"t":"set","p":"payload","pt":"msg","to":"ask-presence","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":360,"wires":[["86c2173d.241b08"]]},{"id":"20815855.34b168","type":"change","z":"83b42288.2eb27","name":"say-coming","rules":[{"t":"set","p":"payload","pt":"msg","to":"say-coming","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":400,"wires":[["9b02a9a5.291f08"]]},{"id":"72540216.d5f0ec","type":"change","z":"83b42288.2eb27","name":"assign","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.intents[0].name","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1250,"y":140,"wires":[["fea9ac5c.448fc"]]},{"id":"cf5f4fab.23461","type":"function","z":"83b42288.2eb27","name":"token","func":"flow.set(\"token\", msg.payload.token)\nreturn {payload: msg.payload};","outputs":1,"noerr":0,"x":230,"y":140,"wires":[["97938285.a463d"]]},{"id":"68e1d9da.6bdf78","type":"change","z":"83b42288.2eb27","name":"say-nointent","rules":[{"t":"set","p":"payload","pt":"msg","to":"say-nointent","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":480,"wires":[["9b02a9a5.291f08"]]},{"id":"3f1343e.d90b9bc","type":"mqtt out","z":"83b42288.2eb27","name":"intent","topic":"hermes/intent","qos":"","retain":"","broker":"7c4ce906.75ea08","x":1250,"y":180,"wires":[]},{"id":"c2b86d70.bff77","type":"change","z":"83b42288.2eb27","name":"assign","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.file","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["9b02a9a5.291f08"]]},{"id":"d17d428a.fb69a","type":"change","z":"83b42288.2eb27","name":"assign","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.file","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":600,"wires":[["9a9ca9fa.ec5e18"]]},{"id":"ddd83762.e6ea58","type":"function","z":"83b42288.2eb27","name":"assign","func":"var s = \"cset numid=1 75%\"\n\nreturn {payload: s};","outputs":1,"noerr":0,"x":710,"y":540,"wires":[["b68f041a.5a66e8"]]},{"id":"b68f041a.5a66e8","type":"exec","z":"83b42288.2eb27","command":"amixer","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"mixer","x":830,"y":540,"wires":[[],[],[]]},{"id":"55b683a7.d0365c","type":"function","z":"83b42288.2eb27","name":"assign","func":"var s = \"cset numid=1 90%\"\n\nreturn {payload: s};","outputs":1,"noerr":0,"x":310,"y":280,"wires":[["f537a4fc.8b5a28"]]},{"id":"f537a4fc.8b5a28","type":"exec","z":"83b42288.2eb27","command":"amixer","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"mixer","x":430,"y":280,"wires":[["97938285.a463d"],[],[]]},{"id":"7c4ce906.75ea08","type":"mqtt-broker","z":"","name":"HASS","broker":"192.168.101.113","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""}]
